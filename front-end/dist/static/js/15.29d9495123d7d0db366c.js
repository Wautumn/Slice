webpackJsonp([15],{kH2O:function(t,e){},uNDi:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("3cXf"),o=a.n(s),r=a("HzJ8"),n=a.n(r),i="http://localhost:8080/viewYearHistory",d="http://localhost:8080/summary/querybyyear";var l=new Date,c=l.format("yyyy-MM-dd"),u=l.format("yyyy-MM")+"-01",h=new Date(u),y={selfRating:0,content:"今天没有写自评哦"},v={data:function(){return{i:0,userID:2,updateSum:!0,storedTomoYear:[],storedTaskYear:[],date:[h,l],showSumData:[y,y],showData:[],sourceData:[],rate:5,pageSize:2,size:0,selectedItem:"已完成的番茄"}},beforeCreate:function(){localStorage.clear()},mounted:function(){var t=this;openDB("dayTomoDB"),openDB("dayTaskDB"),openDB("daySumDB"),this.userID=sessionStorage.userId,localStorage.dayhis?(this.storedTomoYear=JSON.parse(localStorage.storedTomoYear),this.storedTaskYear=JSON.parse(localStorage.storedTaskYear),searchData(u,c,function(){var e=dbData;t.updateData(e)},"dayTomoDB")):(this.$http.get(d,{params:{userid:this.userID,year:(new Date).getFullYear()}}).then(function(e){var a=e.body,s=(t.date[0].format("yyyy-MM-dd"),t.date[1].format("yyyy-MM-dd"),!0),o=!1,r=void 0;try{for(var i,d=n()(a);!(s=(i=d.next()).done);s=!0){var l=i.value;saveData(l,"daySumDB")}}catch(t){o=!0,r=t}finally{try{!s&&d.return&&d.return()}finally{if(o)throw r}}}).catch(function(){console.log("获取小结信息失败")}),localStorage.dayhis=!0,this.$http.get(i,{params:{userId:this.userID,year:(new Date).getFullYear()+"-01-01"}}).then(function(e){var a=e.body,s=date_slice(t.date[0].format("yyyy-MM-dd"),t.date[1].format("yyyy-MM-dd"),a);t.updateData(s);var o=!0,r=!1,i=void 0;try{for(var d,l=n()(a);!(o=(d=l.next()).done);o=!0){var c=d.value;saveData(c,"dayTomoDB")}}catch(t){r=!0,i=t}finally{try{!o&&l.return&&l.return()}finally{if(r)throw i}}t.storedTomoYear=[(new Date).getFullYear().toString()]},function(t){console.log("获取番茄信息失败")}).catch(function(t){console.log("处理请求失败"+t)}),localStorage.storedTomoYear=o()(this.storedTomoYear),localStorage.storedTaskYear=o()(this.storedTaskYear))},methods:{getWeekByDay:function(t){var e=new Date(Date.parse(t.replace(/-/g,"/")));return new Array("星期日","星期一","星期二","星期三","星期四","星期五","星期六")[e.getDay()]},timeChange:function(t){var e=this;console.log("timechange");var a=t[1].split("-")[0],s=t[0].split("-")[0];if(a!==s)return this.$Message.info("选择的时间范围不能跨年"),console.log("跨年选择失败"),void(this.date=[]);var o=void 0,r=void 0;"已完成的番茄"==this.selectedItem||"中断的番茄"==this.selectedItem?(o=this.storedTomoYear,r="dayTomoDB"):"已完成的任务"!=this.selectedItem&&"放弃的任务"!=this.selectedItem||(o=this.storedTaskYear,r="dayTaskDB"),-1==o.indexOf(a)?(console.log("溢出"),this.requestData(s,2,r)):(console.log("不溢出"),searchData(t[0],t[1],function(){var t=dbData;e.updateData(t)},r))},valueChange:function(t){var e=this,a=void 0,s=void 0,o=this.date[0].format("yyyy");"已完成的番茄"==t||"中断的番茄"==t?(a=this.storedTomoYear,s="dayTomoDB"):"已完成的任务"!=t&&"放弃的任务"!=t||(a=this.storedTaskYear,s="dayTaskDB"),-1==a.indexOf(o)?(console.log("溢出"),this.requestData(o,2,s)):(console.log("不溢出"),searchData(this.date[0].format("yyyy-MM-dd"),this.date[1].format("yyyy-MM-dd"),function(){var t=dbData;e.updateData(t)},s))},pageChange:function(t){var e=this,a=(t-1)*this.pageSize,s=t*this.pageSize;this.showData=this.sourceData.slice(a,s),this.updateSum=!0,this.i=0;for(var o=0;o<this.showData.length;o++){var r=this.showData[o].date;readData(r,"daySumDB",function(){e.updateSumData(dbData)})}},updateSumData:function(t){this.showSumData[this.i]=t||y,this.i++,this.i==this.showData.length&&(this.updateSum=!1)},tomotoNum:function(t){if(t)return t.length},totalTime:function(t){if(t){for(var e=0,a=0;a<t.length;a++)e+=(r=t[a].start,n=t[a].end,void 0,i=new Date("2014-04-23 "+r),(new Date("2014-04-23 "+n)-i)/6e4);var s=parseInt(e/60),o=e%60;return 0===s?o+"分钟":s+"小时"+o+"分钟"}var r,n,i},updateData:function(t){var e=void 0,a=void 0;"已完成的番茄"==this.selectedItem?(e=1,a=0):"已完成的任务"==this.selectedItem?(e=2,a=1):"放弃的任务"==this.selectedItem?(e=-1,a=1):"中断的番茄"==this.selectedItem&&(e=-1,a=0),this.sourceData=function(t,e,a){return 0==a?t.map(function(t){return{content:t.content.filter(function(t){return t.status==e}),date:t.date}}).filter(function(t){return t.content.length>0}):1==a?t.map(function(t){return{tempResult:t.tempResult.filter(function(t){return t.status==e}),date:t.date}}).filter(function(t){return t.tempResult.length>0}):t}(t,e,a),this.size=this.sourceData.length,this.pageChange(1)},requestData:function(t,e,a){var s=this;this.$http.get(d,{params:{userid:this.userID,year:t}}).then(function(t){var e=t.body;s.date[0].format("yyyy-MM-dd"),s.date[1].format("yyyy-MM-dd");var a=!0,o=!1,r=void 0;try{for(var i,d=n()(e);!(a=(i=d.next()).done);a=!0){var l=i.value;saveData(l,"daySumDB")}}catch(t){o=!0,r=t}finally{try{!a&&d.return&&d.return()}finally{if(o)throw r}}}).catch(function(){console.log("获取小结失败")}),"dayTomoDB"==a?this.$http.get(i,{params:{userId:this.userID,year:t+"-01-01"}}).then(function(a){var r=a.body,i=s.date[0].format("yyyy-MM-dd"),d=s.date[1].format("yyyy-MM-dd");0===e?i=t+"-01-01":1===e&&(d=t+"-12-31");var l=date_slice(i,d,r);s.updateData(l);var c=!0,u=!1,h=void 0;try{for(var y,v=n()(r);!(c=(y=v.next()).done);c=!0){var m=y.value;saveData(m,"dayTomoDB")}}catch(t){u=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(u)throw h}}s.storedTomoYear.push(t),localStorage.storedTomoYear=o()(s.storedTomoYear)}).catch(function(){console.log("获取番茄信息失败")}):"dayTaskDB"==a&&this.$http.get("http://localhost:8080/task/querybyyear",{params:{userId:this.userID,startyear:t,endyear:t}}).then(function(a){var r=a.body,i=s.date[0].format("yyyy-MM-dd"),d=s.date[1].format("yyyy-MM-dd");0===e?i=t+"-01-01":1===e&&(d=t+"-12-31");var l=date_slice(i,d,r);s.updateData(l);var c=!0,u=!1,h=void 0;try{for(var y,v=n()(r);!(c=(y=v.next()).done);c=!0){var m=y.value;saveData(m,"dayTaskDB")}}catch(t){u=!0,h=t}finally{try{!c&&v.return&&v.return()}finally{if(u)throw h}}s.storedTaskYear.push(t),localStorage.storedTaskYear=o()(s.storedTaskYear)}).catch(function(t){console.log("获取任务信息失败"+t)})}},computed:{}},m={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"list-container"},[a("div",{staticClass:"list-side"},[a("DatePicker",{attrs:{type:"daterange","show-week-numbers":"",placement:"bottom-end",placeholder:"Select date"},on:{"on-change":t.timeChange},model:{value:t.date,callback:function(e){t.date=e},expression:"date"}}),t._v(" "),a("Select",{staticClass:"selector",on:{"on-change":t.valueChange},model:{value:t.selectedItem,callback:function(e){t.selectedItem=e},expression:"selectedItem"}},[a("OptionGroup",{attrs:{label:"Task"}},[a("Option",{attrs:{value:"已完成的任务"}},[t._v("已完成的任务")]),t._v(" "),a("Option",{attrs:{value:"放弃的任务"}},[t._v("放弃的任务")])],1),t._v(" "),a("OptionGroup",{attrs:{label:"Pomoto"}},[a("Option",{attrs:{value:"已完成的番茄"}},[t._v("已完成的番茄")]),t._v(" "),a("Option",{attrs:{value:"中断的番茄"}},[t._v("中断的番茄")])],1)],1)],1),t._v(" "),t._l(t.showData,function(e,s){return 0!==t.showData.length?a("div",{key:e.id,staticClass:"list-head"},[a("div",{staticClass:"list-second-head"},[a("p",{staticClass:"card-head"},[t._v(t._s(e.date))]),t._v(" "),a("p",{staticClass:"card-extra"},[t._v(t._s(t.getWeekByDay(e.date)))])]),t._v(" "),"已完成的番茄"===t.selectedItem||"中断的番茄"===t.selectedItem?a("Timeline",{staticClass:"time-line"},t._l(e.content,function(e){return a("TimelineItem",{key:e.id},[a("p",{staticClass:"time"},[t._v(t._s(e.start+"-"+e.end))]),t._v(" "),a("p",{staticClass:"content"},[t._v(t._s(e.text))])])}),1):t._e(),t._v(" "),"已完成的任务"===t.selectedItem||"放弃的任务"===t.selectedItem?a("Timeline",{staticClass:"time-line"},t._l(e.tempResult,function(e){return a("TimelineItem",{key:e.id},[a("p",{staticClass:"time"},[t._v(t._s(e.time))]),t._v(" "),a("p",{staticClass:"content"},[t._v(t._s(e.content))])])}),1):t._e(),t._v(" "),"已完成的番茄"===t.selectedItem?a("div",{staticClass:"box-card"},[a("p",[t._v("完成了"+t._s(t.tomotoNum(e.content))+"个番茄")]),t._v(" "),a("p",[t._v("总计"+t._s(t.totalTime(e.content)))])]):"已完成的任务"===t.selectedItem?a("div",{staticClass:"box-card"},[a("p",[t._v("完成了"+t._s(t.tomotoNum(e.tempResult))+"个任务")])]):"放弃的任务"===t.selectedItem?a("div",{staticClass:"box-card"},[a("p",[t._v("放弃了"+t._s(t.tomotoNum(e.tempResult))+"个任务")])]):"中断的番茄"===t.selectedItem?a("div",{staticClass:"box-card"},[a("p",[t._v("放弃了"+t._s(t.tomotoNum(e.content))+"个番茄")])]):t._e(),t._v(" "),t.updateSum?a("el-card",{staticClass:"box-card card-sum",attrs:{shadow:"never"}},[t._v("每日小结\n      "),a("Rate",{staticStyle:{float:"right"},attrs:{"allow-half":"",disabled:"",value:0}}),t._v(" "),a("p",{staticClass:"sum-content"},[t._v("你今天没有写小结哦。")])],1):a("el-card",{staticClass:"box-card card-sum",attrs:{shadow:"never"}},[t._v("每日小结\n      "),a("Rate",{staticStyle:{float:"right"},attrs:{"allow-half":"",disabled:"",value:t.showSumData[s].selfRating}}),t._v(" "),a("p",{staticClass:"sum-content"},[t._v(t._s(t.showSumData[s].content))])],1)],1):t._e()}),t._v(" "),0==t.showData.length?a("div",[t._v("没有可用数据")]):t._e(),t._v(" "),a("Page",{staticClass:"footer",attrs:{total:t.size,"page-size":t.pageSize,"show-elevator":""},on:{"on-change":t.pageChange}})],2)},staticRenderFns:[]};var f=a("C7Lr")(v,m,!1,function(t){a("kH2O")},"data-v-29402844",null);e.default=f.exports}});
//# sourceMappingURL=15.29d9495123d7d0db366c.js.map